<div class="combat-section">

  <div class="weapons">
    <!-- <h3 class="melee-title">Melee Weapons</h3> -->
    <div class="melee-type">
      <div class="inventory-header melee-title">
        <div class="header-name">Melee Weapon(s)<a class = "fist-icon"><i class="fa fa-fist-raised"></i></a> </div>
        <div class="header-group">Group</div>
        <div class="header-damage">Damage</div>
        <div class="header-reach">Reach</div>
        <!-- <div class="header-qualities">Qualities/Flaws</div> -->
      </div>
      <ol class="inventory-list weapon-list" weapon-type="melee">
        {{#each actor.weapons as |item i|}}
        {{#if item.meleeWeaponType}}
        <li class="item" data-item-id="{{item.id}}">
          <div class="weapon-name">
            <a class="item-image" style="background-image: url({{item.img}})"></a>
            <a class="weapon-item-name">{{item.name}}</a>
          </div>
          <a class="weapon-group">{{item.data.weaponGroup.value}}</a>
          <div class="weapon-damage">+{{item.data.damage.value}}</div>
          <a class="weapon-reach">{{item.data.reach.value}}</a>
          <div class="weapon-property">
            <div>


              {{#if item.properties.special}}
              {{#each item.properties.special as |property p|}}
              <a class='ranged-property-quality quality-label'>{{property}}</a>
              {{/each}}
              {{/if}}


              {{#if item.properties.qualities}}
              <span class="quality-label">Q:</span>
              {{#each item.properties.qualities as |property p|}}
              <a class='melee-property-quality'>{{property}},</a>
              {{/each}}
              {{/if}}

              {{#if item.properties.flaws}}
              <span class="flaw-label">F:</span>
              {{#each item.properties.flaws as |property p|}}
              <a class='melee-property-flaw'>{{property}},</a>
              {{/each}}
              {{/if}}
            </div>
            <script>
              var x = document.getElementsByClassName('melee-property-quality');
              xLength = x.length;
              xLast = x.item(xLength - 1);
              xLastVal = JSON.stringify(xLast.textContent);
              var xNewVal = xLastVal;
              xNewVal = xNewVal.replace(',', '');
              xNewVal = xNewVal.replace(/['"]+/g, '');
              document.getElementsByClassName('melee-property-quality')[xLength - 1].textContent = xNewVal;

              // FLAWS
              var y = document.getElementsByClassName('melee-property-flaw');
              yLength = y.length;
              yLast = y.item(yLength - 1);
              yLastVal = JSON.stringify(yLast.textContent);
              var yNewVal = yLastVal;
              yNewVal = yNewVal.replace(',', '');
              yNewVal = yNewVal.replace(/['"]+/g, '');
              document.getElementsByClassName('melee-property-flaw')[yLength - 1].textContent = yNewVal;
            </script>
        </li>
        {{/if}}
        {{/each}}
      </ol>
    </div>

    <!-- <h3 class="ranged-title">Ranged Weapons</h3> -->
    <div class="ranged-type">
      <div class="inventory-header ranged-title">
        <div class="header-name">Ranged Weapon(s)</div>
        <div class="header-group">Group</div>
        <div class="header-ammo">Ammunition</div>
        <div class="header-damage">Damage</div>
        <div class="header-range">Range</div>
        <!-- <div class="header-qualities">Qualities/Flaws</div> -->
      </div>
      <ol class="inventory-list weapon-list" weapon-type="ranged">
        {{#each actor.weapons as |item i|}}
        {{#if item.rangedWeaponType}}
        <li class="item" data-item-id="{{item.id}}">
          <div class="weapon-name">
            <div class="item-image" style="background-image: url({{item.img}})"></div>
            <a class="weapon-item-name">{{item.name}}</a>
          </div>
          <a class="weapon-group">{{item.data.weaponGroup.value}}</a>
          {{#if item.data.ammunitionGroup.value}}
          <div class="ammo-selector selector">
            <select name="item.data.currentAmmo.value" data-item-id="{{item.id}}"
              data-dtype="{{item.data.currentAmmo.type}}">
              {{#select item.data.currentAmmo.value}}
              <option class="ammo-option" value="0">None</option>
              {{#each item.ammo as |ammo a|}}
              <option class="ammo-option" value="{{ammo.id}}"> ({{ammo.data.quantity.value}}) {{ammo.name}}</option>
              {{/each}}
              {{/select}}
            </select>
          </div>
          {{else}}
          <div>
            None
          </div>
          {{/if}}
          <div class="weapon-damage">+{{item.data.damage.value}}</div>
          <a class="weapon-range">{{item.data.range.value}}</a>
          <div class="weapon-property">

            {{#if item.properties.special}}
            {{#each item.properties.special as |property p|}}
            <a class='ranged-property-quality quality-label'>{{property}}</a>
            {{/each}}
            {{/if}}

            {{#if item.properties.qualities}}
            <span class="quality-label">Q:</span>
            {{#each item.properties.qualities as |property p|}}
            <a class='ranged-property-quality'>{{property}},</a>
            {{/each}}
            {{/if}}

            {{#if item.properties.flaws}}
            <span class="flaw-label">F:</span>
            {{#each item.properties.flaws as |property p|}}
            <a class='ranged-property-flaw'>{{property}},</a>
            {{/each}}
            {{/if}}

          </div>
          <script>
            var x = document.getElementsByClassName('ranged-property-quality');
            console.log(x);
            xLength = x.length;
            console.log(xLength);
            xLast = x.item(xLength - 1);
            console.log(xLast);
            xLastVal = JSON.stringify(xLast.textContent);
            console.log(xLastVal);
            console.log(typeof xLastVal);
            console.log(xLastVal.length);
            var xNewVal = xLastVal;

            xNewVal = xNewVal.replace(',', '');
            xNewVal = xNewVal.replace(/['"]+/g, '');


            console.log(xNewVal);


            // console.log(document.getElementsByClassName('melee-property-quality')[xLength - 1].textContent); 
            document.getElementsByClassName('ranged-property-quality')[xLength - 1].textContent = xNewVal;

            // FLAWS
            var y = document.getElementsByClassName('ranged-property-flaw');
            console.log(y);
            yLength = y.length;
            console.log(yLength);
            yLast = y.item(yLength - 1);
            console.log(yLast);
            yLastVal = JSON.stringify(yLast.textContent);
            console.log(yLastVal);
            console.log(typeof yLastVal);
            console.log(yLastVal.length);
            var yNewVal = yLastVal;

            yNewVal = yNewVal.replace(',', '');
            yNewVal = yNewVal.replace(/['"]+/g, '');


            console.log(yNewVal);


            // console.log(document.getElementsByClassName('melee-property-quality')[yLength - 1].teytContent); 
            document.getElementsByClassName('ranged-property-flaw')[yLength - 1].textContent = yNewVal;
          </script>
        </li>
        {{/if}}
        {{/each}}
      </ol>
    </div>
  </div>

  <div class="armor">
    <div class="armor-first-row">
      <div class="head-section">
        <div class="armor-header head">
          <span class="armor-total" title="Armour AP">{{actor.AP.head}}</span>
          <span class="shield-total" title="Shield AP">{{actor.AP.shield}}</span>
          <span class="toughness-total" title="Toughness Bonus">{{actor.data.characteristics.t.bonus}}</span>
          <span class="armor-label">Head</span>
          <span class="armor-ap">AP</span>
        </div>
        <div class="armor-box head">
          <ol class="inventory-list armor-list">
            {{#each actor.armour as |item i|}}
            {{#if item.protectsHead}}
            <li class="item" data-item-id="{{item.id}}" data-location="head">
              <div class="item-image item-name" title="{{item.name}}" style="background-image: url({{item.img}})"></div>
              <a class="armor-item-name">{{item.name}}</a>
              <a title="Current: {{item.data.currentAP.head}} Max: {{item.data.maxAP.head}}"
                class="ap-value">{{item.data.currentAP.head}}</a>

              <!--Copy this into the other list items once its been styled-->
              {{#if item.properties.special}}
              {{#each item.properties.special as |property p|}}
              <a class='armor-quality quality-label'>{{property}}</a>
              {{/each}}
              {{/if}}

              {{#if item.properties.qualities}}
              <span class="quality-label">Q: </span>
              {{#each item.properties.qualities as |property p|}}
              <a class='armor-quality'>{{property}},&nbsp;</a>
              {{/each}}
              {{/if}}

              {{#if item.properties.flaws}}
              <span class="flaw-label">F:</span>
              {{#each item.properties.flaws as |property p|}}
              <a class='armor-quality'>{{property}},&nbsp;</a>
              {{/each}}
              {{/if}}
              <!-- Copy ends here-->

            </li>
            {{/if}}
            {{/each}}
          </ol>
        </div>
      </div>
      <div class="body-section">
        <div class="armor-header body">
          <span class="armor-total" title="Armour AP">{{actor.AP.body}}</span>
          <span class="shield-total" title="Shield AP">{{actor.AP.shield}}</span>
          <span class="toughness-total" title="Toughness Bonus">{{actor.data.characteristics.t.bonus}}</span>
          <span class="armor-label">Body</span>
          <span class="armor-ap">AP</span>
        </div>
        <div class="armor-box body">
          <ol class="inventory-list armor-list">
            {{#each actor.armour as |item i|}}
            {{#if item.protectsBody}}
            <li class="item" data-item-id="{{item.id}}" data-location="body">
              <div class="item-image item-name" title="{{item.name}}" style="background-image: url({{item.img}})"></div>
              <a class="armor-item-name">{{item.name}}</a>
              <a title="Current: {{item.data.currentAP.body}} Max: {{item.data.maxAP.body}}"
                class="ap-value">{{item.data.currentAP.body}}</a>

              <!--Copy this into the other list items once its been styled-->
              {{#if item.properties.special}}
              {{#each item.properties.special as |property p|}}
              <a class='armor-quality quality-label'>{{property}}</a>
              {{/each}}
              {{/if}}

              {{#if item.properties.qualities}}
              <span class="quality-label">Q: </span>
              {{#each item.properties.qualities as |property p|}}
              <a class='armor-quality'>{{property}},&nbsp;</a>
              {{/each}}
              {{/if}}

              {{#if item.properties.flaws}}
              <span class="flaw-label">F:</span>
              {{#each item.properties.flaws as |property p|}}
              <a class='armor-quality'>{{property}},&nbsp;</a>
              {{/each}}
              {{/if}}
              <!-- Copy ends here-->
            </li>
            {{/if}}
            {{/each}}
          </ol>
        </div>
      </div>
    </div>

    <div class="armor-second-row">
      <div class="lArm-section">
        <div class="armor-header lArm">
          <span class="armor-total" title="Armour AP">{{actor.AP.lArm}}</span>
          <span class="shield-total" title="Shield AP">{{actor.AP.shield}}</span>
          <span class="toughness-total" title="Toughness Bonus">{{actor.data.characteristics.t.bonus}}</span>
          <span class="armor-label">Left Arm</span>
          <span class="armor-ap">AP</span>
        </div>
        <div class="armor-box lArm">
          <ol class="inventory-list armor-list">
            {{#each actor.armour as |item i|}}
            {{#if item.protectslArm}}
            <li class="item" data-item-id="{{item.id}}" data-location="lArm">
              <div class="item-image item-name" title="{{item.name}}" style="background-image: url({{item.img}})"></div>
              <a class="armor-item-name">{{item.name}}</a>
              <a title="Current: {{item.data.currentAP.lArm}} Max: {{item.data.maxAP.lArm}}"
                class="ap-value">{{item.data.currentAP.lArm}}</a>

              <!--Copy this into the other list items once its been styled-->
              {{#if item.properties.special}}
              {{#each item.properties.special as |property p|}}
              <a class='armor-quality quality-label'>{{property}}</a>
              {{/each}}
              {{/if}}

              {{#if item.properties.qualities}}
              <span class="quality-label">Q: </span>
              {{#each item.properties.qualities as |property p|}}
              <a class='armor-quality'>{{property}},&nbsp;</a>
              {{/each}}
              {{/if}}

              {{#if item.properties.flaws}}
              <span class="flaw-label">F:</span>
              {{#each item.properties.flaws as |property p|}}
              <a class='armor-quality'>{{property}},&nbsp;</a>
              {{/each}}
              {{/if}}
              <!-- Copy ends here-->
            </li>
            {{/if}}
            {{/each}}
          </ol>
        </div>
      </div>
      <div class="rArm-section">
        <div class="armor-header rArm">
          <span class="armor-total" title="Armour AP">{{actor.AP.rArm}}</span>
          <span class="shield-total" title="Shield AP">{{actor.AP.shield}}</span>
          <span class="toughness-total" title="Toughness Bonus">{{actor.data.characteristics.t.bonus}}</span>
          <span class="armor-label">Right Arm</span>
          <span class="armor-ap">AP</span>
        </div>
        <div class="armor-box body">
          <ol class="inventory-list armor-list">
            {{#each actor.armour as |item i|}}
            {{#if item.protectsrArm}}
            <li class="item" data-item-id="{{item.id}}" data-location="body">
              <div class="item-image item-name" title="{{item.name}}" style="background-image: url({{item.img}})"></div>
              <a class="armor-item-name">{{item.name}}</a>
              <a title="Current: {{item.data.currentAP.rArm}} Max: {{item.data.maxAP.rArm}}"
                class="ap-value">{{item.data.currentAP.rArm}}</a>

              <!--Copy this into the other list items once its been styled-->
              {{#if item.properties.special}}
              {{#each item.properties.special as |property p|}}
              <a class='armor-quality quality-label'>{{property}}</a>
              {{/each}}
              {{/if}}

              {{#if item.properties.qualities}}
              <span class="quality-label">Q: </span>
              {{#each item.properties.qualities as |property p|}}
              <a class='armor-quality'>{{property}},&nbsp;</a>
              {{/each}}
              {{/if}}

              {{#if item.properties.flaws}}
              <span class="flaw-label">F:</span>
              {{#each item.properties.flaws as |property p|}}
              <a class='armor-quality'>{{property}},&nbsp;</a>
              {{/each}}
              {{/if}}
              <!-- Copy ends here-->

            </li>
            {{/if}}
            {{/each}}
          </ol>
        </div>
      </div>
    </div>

    <div class="armor-third-row">
      <div class="lLeg-section">
        <div class="armor-header lLeg">
          <span class="armor-total" title="Armour AP">{{actor.AP.lLeg}}</span>
          <span class="shield-total" title="Shield AP">{{actor.AP.shield}}</span>
          <span class="toughness-total" title="Toughness Bonus">{{actor.data.characteristics.t.bonus}}</span>
          <span class="armor-label">Left Leg</span>
          <span class="armor-ap">AP</span>
        </div>
        <div class="armor-box lLeg">
          <ol class="inventory-list armor-list">
            {{#each actor.armour as |item i|}}
            {{#if item.protectslLeg}}
            <li class="item" data-item-id="{{item.id}}" data-location="lLeg">
              <div class="item-image item-name" title="{{item.name}}" style="background-image: url({{item.img}})"></div>
              <a class="armor-item-name">{{item.name}}</a>
              <a title="Current: {{item.data.currentAP.lLeg}} Max: {{item.data.maxAP.lLeg}}"
                class="ap-value">{{item.data.currentAP.lLeg}}</a>

              <!--Copy this into the other list items once its been styled-->
              {{#if item.properties.special}}
              {{#each item.properties.special as |property p|}}
              <a class='armor-quality quality-label'>{{property}}</a>
              {{/each}}
              {{/if}}

              {{#if item.properties.qualities}}
              <span class="quality-label">Q: </span>
              {{#each item.properties.qualities as |property p|}}
              <a class='armor-quality'>{{property}},&nbsp;</a>
              {{/each}}
              {{/if}}

              {{#if item.properties.flaws}}
              <span class="flaw-label">F:</span>
              {{#each item.properties.flaws as |property p|}}
              <a class='armor-quality'>{{property}},&nbsp;</a>
              {{/each}}
              {{/if}}
              <!-- Copy ends here-->


            </li>
            {{/if}}
            {{/each}}
          </ol>
        </div>
      </div>
      <div class="rLeg-section">
        <div class="armor-header rLeg">
          <span class="armor-total" title="Armour AP">{{actor.AP.rLeg}}</span>
          <span class="shield-total" title="Shield AP">{{actor.AP.shield}}</span>
          <span class="toughness-total" title="Toughness Bonus">{{actor.data.characteristics.t.bonus}}</span>
          <span class="armor-label">Right Leg</span>
          <span class="armor-ap">AP</span>
        </div>
        <div class="armor-box rLeg">
          <ol class="inventory-list armor-list">
            {{#each actor.armour as |item i|}}
            {{#if item.protectsrArm}}
            <li class="item" data-item-id="{{item.id}}" data-location="rLeg">
              <div class="item-image item-name" title="{{item.name}}" style="background-image: url({{item.img}})"></div>
              <a class="armor-item-name">{{item.name}}</a>
              <a title="Current: {{item.data.currentAP.rLeg}} Max: {{item.data.maxAP.rLeg}}"
                class="ap-value">{{item.data.currentAP.rLeg}}</a>

              <!--Copy this into the other list items once its been styled-->
              {{#if item.properties.special}}
              {{#each item.properties.special as |property p|}}
              <a class='armor-quality quality-label'>{{property}}</a>
              {{/each}}
              {{/if}}

              {{#if item.properties.qualities}}
              <span class="quality-label">Q: </span>
              {{#each item.properties.qualities as |property p|}}
              <a class='armor-quality'>{{property}},&nbsp;</a>
              {{/each}}
              {{/if}}

              {{#if item.properties.flaws}}
              <span class="flaw-label">F:</span>
              {{#each item.properties.flaws as |property p|}}
              <a class='armor-quality'>{{property}},&nbsp;</a>
              {{/each}}
              {{/if}}
              <!-- Copy ends here-->

            </li>
            {{/if}}
            {{/each}}
          </ol>
        </div>
      </div>
    </div>
  </div>

  <div class="injury-header">
    <a class="injury-label">Injury</a>
    <a class="location-label">Location</a>
  </div>

  <div class="injury">
    <li class="inventory-header item">
      <div class="injury-name">Injury
      </div>
      <div>Location</div>
      {{#if owner}}
      <div class="item-controls">
        <a class="item-control item-create" title="Create Item" data-type="{{sid}}"><i class="fas fa-plus"></i>
          Add</a>
      </div>
    </li>
    <ol class="inventory-list crit-wound-list">
      {{/if}}
      {{#each actor.injuries as |injury i|}}
      <li class="item" data-item-id="{{injury.id}}">
        <div class="item-name injury-name">
          <div class="item-image" style="background-image: url({{injury.img}})"></div>
          <h4 class="injury-title">{{injury.name}}</h4>
        </div>

        <div class="injury-location">
          {{injury.data.location.value}}
        </div>

        {{#if ../owner}}
        <div class="item-controls">
          <a class="item-control item-edit" title="Edit Item"><i class="fas fa-edit"></i></a>
          <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
        </div>
        {{/if}}

      </li>
      {{/each}}
    </ol>
  </div>

</div>
